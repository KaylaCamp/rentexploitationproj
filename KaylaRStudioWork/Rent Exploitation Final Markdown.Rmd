---
title: "Rent Exploitation Final Markdown"
author: "Kayla Campbell"
date: '2022-07-06'
output: html_document
---
Intro on the history of Charlottesville...
         the housing market...
         renter explotation...
#map census tracs rave v. median income         
##Loading packages for exploration
```{r}
library(readr)
library(leaflet)
library(ggplot2)
library(dplyr)
library(scales)
library(tidyverse)
library(tigris)
library(sf)
library(viridis)
library(RColorBrewer)
```


```{r}
# Reading in exported data to R markdown
library(readr)
ACSData2020 <- read_csv("ACSData2020.csv")
ACSData2020
```
Let us find the rent burden by race by the ratio of median household income to median rent. What race is the most rent burdened? 
```{r}
ggplot(ACSData2020)+
  aes(x=, y=TotalValue) +
  geom_point()+
  geom_smooth()+
  facet_wrap(~HSDistrict)
```

Let us find the median values per region.
```{r}
ACSData2020 %>% 
  group_by(Region) %>% 
  summarize(MedRentEst= median(MedRentE, na.rm=TRUE), MedTaxEst=median(MedTaxE, na.rm=TRUE), MedRentTaxRatEst=median(RentTaxRatE, na.rm=TRUE), MedRenterHHIncomeEst =median(MedRenterHHIncomeE, na.rm=TRUE), MedHHIncomeEst=median(MedHHIncomeE, na.rm=TRUE),  MedRentBurdenPercEst=median(MedRentBurdenPercE, na.rm=TRUE),  WhiteMedHHIncomeEst=median(WhiteMedHHIncomeE, na.rm=TRUE), BlackMedHHIncomeEst=median(BlackMedHHIncomeE, na.rm=TRUE), HispanicLatinoMedHHIncomeEst=median(HispanicLatinoMedHHIncomeE, na.rm=TRUE))
```
visulizing some of these findings...
```{r}

```

... and further by county.
```{r}
ACSData2020 %>% 
  group_by(County) %>% 
  summarize(MedRentEst= median(MedRentE, na.rm=TRUE), MedTaxEst=median(MedTaxE, na.rm=TRUE), MedRentTaxRatEst=median(RentTaxRatE, na.rm=TRUE), MedRenterHHIncomeEst =median(MedRenterHHIncomeE, na.rm=TRUE), MedHHIncomeEst=median(MedHHIncomeE, na.rm=TRUE),  MedRentBurdenPercEst=median(MedRentBurdenPercE, na.rm=TRUE),  WhiteMedHHIncomeEst=median(WhiteMedHHIncomeE, na.rm=TRUE), BlackMedHHIncomeEst=median(BlackMedHHIncomeE, na.rm=TRUE), HispanicLatinoMedHHIncomeEst=median(HispanicLatinoMedHHIncomeE, na.rm=TRUE))
```
visulizing some of these findings...
```{r}

```


As defined by Crowell, rent exploitation is the ratio of median rents to median property taxes (Crowell 2). We will examine how rent exploitation varies by counties in the Charlottesville and Richmond regions.
```{r}
counties<-c("Albemarle", "Charlottesville", "Fluvanna", "Greene", "Louisa","Nelson", "Chesterfield County", "Henrico County", "Hopewell City", "Petersburg City", "Richmond City")
countytracts <- tracts(state = "51", county = counties, year = 2020)
countytracts <- TenureByRace %>% 
  #mutate(GEOID=as.numeric(TenureByRace$GEOID)) %>% 
  left_join(TenureByRace,countytracts, by = c( "FipCodes"="COUNTYFP"))

countytracts <- tracts(state = "51", county = cvl, year = 2020)
ACSData2020 <- countytracts %>% 
  mutate(GEOID = as.numeric(countytracts$GEOID))
  st_join(ACSData2020, countytracts, by = c("GEOID"))

by = "GEOID"
countytracts <- tracts(state = "51", county = cvl, year = 2020)
countytracts<-countytracts %>% 
  mutate(GEOID = as.numeric(countytracts$GEOID))
# by = c("GEOID1" = "GEOID2")
PovertybyRace <- st_transform(PovertybyRace, 4326)

pal <- colorNumeric("viridis", reverse = TRUE, domain = PovertybyRace$IncomeInequalityE) # viridis
leaflet(PovertybyRace) %>% 
  #addTiles() %>% # basemap
  addProviderTiles("CartoDB.Positron") %>% # CartoDB.Positron, Stamen.Toner, Esri.NatGeoWorldMap
  addPolygons(fillColor = ~pal(IncomeInequalityE),
              fillOpacity = 0.8,
              color = "white",
              weight = 2,
              highlight = highlightOptions(
                weight = 3,
                fillOpacity = 0.9,
                bringToFront = T),
              popup = paste0("County: ", PovertybyRace$County, "<br>",
                             "Tract: ", PovertybyRace$NAMELSAD, "<br>",
                             "Gini Index: ", round(PovertybyRace$IncomeInequalityE, 2)))%>% 
  addLegend("topright", pal = pal, values = PovertybyRace$IncomeInequalityE, 
          title = "Gini Index of Income Inequality", opacity = 0.7)
```

How does the median renters household income relate to the median rent they are paying as proof of rent burden?
```{r}
ggplot(ACSData2020) +
  aes(x = MedRenterHHIncomeE, y = MedRentE) +
  geom_point() 
```
Which census tracts face the highest le

As expected the lower the household income the less the renter can afford to pay. However does how much they are paying 
`
```{r}
TenureByRace <- read_csv("TenureByRaceData.csv")
TenureByRace
```
```{r}
counties<-c("Albemarle", "Charlottesville", "Fluvanna", "Greene", "Louisa","Nelson", "Chesterfield County", "Henrico County", "Hopewell City", "Petersburg City", "Richmond City")
countytracts <- tracts(state = "51", county = counties, year = 2020)
```
A representation of the percentage of Black renters in and around Charlottesville and Richmond Virginia to compare the regions with the predominately greater than Black population with the predominately rent burdened or exploited, etc.

```{r}
TenureByRace<-countytracts %>% 
  mutate(GEOID=as.character(countytracts$GEOID)) %>% 
  st_join(TenureByRace,countytracts, by="GEOID")

TenureByRace <- st_transform(TenureByRace, 4326)
pal <- colorNumeric("viridis", reverse = TRUE, domain = TenureByRace$PercOfBlkRenters) # viridis

leaflet(TenureByRace) %>% 
  #addTiles() %>% # basemap
  addProviderTiles("CartoDB.Positron") %>% # CartoDB.Positron, Stamen.Toner, Esri.NatGeoWorldMap
  addPolygons(fillColor = ~pal(PercOfBlkRenters),
              fillOpacity = 0.8,
              color = "white",
              weight = 2,
              highlight = highlightOptions(
                weight = 3,
                fillOpacity = 0.9,
                bringToFront = T),
              popup = paste0("County: ", TenureByRace$County, "<br>",
                             "Tract: ", TenureByRace$NAMELSAD, "<br>",
                             "Gini Index: ", round(TenureByRace$PercOfBlkRenters, 2)))%>% 
  addLegend("topright", pal = pal, values = TenureByRace$PercOfBlkRenters, 
          title = "Percentage of Black Renters", opacity = 0.7)


```


##Note the lack of representation of housholds in particular census tracts
```{r}
PovertybyRace <- read_csv("PovertybyRaceData.csv")
PovertybyRace
```

A representation of the income inequality occuring in and around Charlottesville and Richmond Virginia based on the Gini Index's ruling.
```{r}
countytracts <- tracts(state = "51", county = cvl, year = 2020)
countytracts<-countytracts %>% 
  mutate(GEOID = as.numeric(countytracts$GEOID))
# by = c("GEOID1" = "GEOID2")
PovertybyRace <- st_transform(PovertybyRace, 4326)

pal <- colorNumeric("viridis", reverse = TRUE, domain = PovertybyRace$IncomeInequalityE) # viridis
leaflet(PovertybyRace) %>% 
  #addTiles() %>% # basemap
  addProviderTiles("CartoDB.Positron") %>% # CartoDB.Positron, Stamen.Toner, Esri.NatGeoWorldMap
  addPolygons(fillColor = ~pal(IncomeInequalityE),
              fillOpacity = 0.8,
              color = "white",
              weight = 2,
              highlight = highlightOptions(
                weight = 3,
                fillOpacity = 0.9,
                bringToFront = T),
              popup = paste0("County: ", PovertybyRace$County, "<br>",
                             "Tract: ", PovertybyRace$NAMELSAD, "<br>",
                             "Gini Index: ", round(PovertybyRace$IncomeInequalityE, 2)))%>% 
  addLegend("topright", pal = pal, values = PovertybyRace$IncomeInequalityE, 
          title = "Gini Index of Income Inequality", opacity = 0.7)
```
Does Charlottesville have a Black middle class?
Demographic map
```{r}
cvl_rva_measures <- read_csv("cvl_rva_measures.csv")
cvl_rva_measures
```
```{r}
countytracts_updated<-countytracts %>% 
  mutate(county_tract=paste(COUNTYFP,TRACTCE, sep="")) 
```

```{r}
cvl_rva_measures<-countytracts_updated %>% 
  left_join(cvl_rva_measures,countytracts_updated, by="county_tract")
```


```{r}

cvl_rva_measures <- st_transform(cvl_rva_measures, 4326)
pal <- colorNumeric("viridis", reverse = FALSE, domain = cvl_rva_measures$dissim_wb_block
) # viridis

leaflet(cvl_rva_measures) %>% 
  #addTiles() %>% # basemap
  addProviderTiles("CartoDB.Positron") %>% # CartoDB.Positron, Stamen.Toner, Esri.NatGeoWorldMap
  addPolygons(fillColor = ~pal(dissim_wb_block
),
              fillOpacity = 0.8,
              color = "white",
              weight = 2,
              highlight = highlightOptions(
                weight = 3,
                fillOpacity = 0.9,
                bringToFront = T),
              popup = paste0("County: ", cvl_rva_measures$County, "<br>",
                             "Tract: ", cvl_rva_measures$NAMELSAD, "<br>",
                             "Dissimilarity Index ", round(cvl_rva_measures$dissim_wb_block
, 2)))%>% 
  addLegend("topright", pal = pal, values = cvl_rva_measures$dissim_wb_block
, 
          title = "Percentage of Black Renters", opacity = 0.7)
```

