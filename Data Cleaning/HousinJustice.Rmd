---
title: "Housing Justice"
output:
  html_document: 
    code_folding: "hide" 
  date: '2022-06-21'
---

```{r}
#code_folding: "hide" (hides the code but ppl can see the code if they want to)
knitr::opts_chunk$set(echo =  TRUE, warning = FALSE, message = FALSE) #doesn't show the messages or the warings, only code output, must be its in own code chunk to apply to all the subsequent ones
```

``` {r}

#Ask dr. claibourne about tables 

#importing data
library(readr)
library(tidycensus)
library(tidyverse)
library(tigris)
library(leaflet)
library(sf)

ACS_Housing_Data <- read_csv("Housing_Data.csv")
Income_By_Tenure <- read_csv("Income_By_Tenure.csv")
Tenure <- read_csv("Tenure.csv")
Tenure_By_Income <- read_csv("Tenure_By_Income.csv")


```



``` {r}

#Ctrl/command + shift + c to comment out all the lines selected
#install.packages("skimr")
#library(skimr)
#skim(ACSHousingData)


```

```{r}
ACS_Housing_Data |>
  group_by(County) |>
  summarize(medrentest = median(MedianRentE), medrenterror = median(MedianRentM), medtaxest = median(MedianTaxesE), medtaxerror = median(MedianTaxesM), Ratioest = median(RentTaxRatio), Ratioerror = median(RentTaxRatioMOE), avgrentest = mean(MedianRentE), avgrenterror = mean(MedianRentM), avgtaxest = mean(MedianTaxesE), avgtaxerror = mean(MedianTaxesM), avgRatioest = mean(RentTaxRatio), avgRatioerror = mean(RentTaxRatioMOE), med_perc_rent_income = median(PercRent0fIncomeE), med_perc_rent_income_moe = median(PercRent0fIncomeM), avg_perc_rent_income = mean(PercRent0fIncomeE), avg_perc_rent_income_moe = mean(PercRent0fIncomeM), na.rm = TRUE)




```


```{r}


hist(ACS_Housing_Data$RentTaxRatio) + facet_wrap(~County)
```


```{r}
#plotting some graphs


ACS_Housing_Data |>
  ggplot() +
  aes(x = County, y = RentTaxRatio) +
  geom_point() 


ggplot(ACS_Housing_Data) +
    geom_bar( aes(x=County, y=RentTaxRatio), stat="identity", fill="skyblue", alpha=0.7) +
    geom_errorbar( aes(x=County, ymin=RentTaxRatio-RentTaxRatioMOE, ymax=RentTaxRatio+RentTaxRatioMOE), width=0.4, colour="orange", alpha=0.9, size=1.3)
```


```{r}
ACS_Housing_Data |>
  ggplot() +
  aes(x = County, y = RentTaxRatio) +
  geom_boxplot() 
```




```{r results = "hide"}
#creating a leaflet map!

#install.packages("tigris")
# library(tigris)

#creating a vector of the counties i need
counties <- c("Albemarle", "Charlottesville", "Fluvanna", "Greene", "Louisa", "Nelson")

#creates a dataframe of the tracts and geographic info in our dataset, can put names or the code numbers for the county argument
countytracts <- tracts(state = "VA", county = counties, year = 2020)
```

``` {r}

#making GEOID numeric so I can join it with ACSHousingData
countytracts <- countytracts |>
  mutate(GEOID = as.numeric(countytracts$GEOID)) 

#joined data, turning into sf object so I can map, remove character strings from the latitude and longitude columns and made them numeric

#by = c("GEOID1" = "GEOID2")
HousingDataSpatial <- full_join(ACS_Housing_Data, countytracts, by = "GEOID") |>
  sf::st_as_sf() |>
  mutate(INTPTLAT = as.numeric(str_remove(countytracts$INTPTLAT, "[^[:alnum:]]")), INTPTLON = as.numeric(str_remove(countytracts$INTPTLON, "[^[:alnum:]]")))  |> 
   sf::st_transform(crs = '+proj=longlat +datum=WGS84')

# create color palette for shading census tracts
pal <-  colorNumeric("YlOrRd", HousingDataSpatial$RentTaxRatio)

#creating map and adding layers
leaflet(HousingDataSpatial) %>% 
  addTiles() %>% 
  addPolygons() %>%
  #addLabelOnlyMarkers(lng = ~INTPTLON, lat = ~INTPTLAT, label = ~NAME.y,
   #                   labelOptions = labelOptions(noHide = TRUE)) %>% #labels census tracts
  addPolygons(stroke = FALSE, fillOpacity = 0.5, 
              smoothFactor = 0.5, 
              color = ~pal(RentTaxRatio),
              label = ~RentTaxRatio) %>% 
  addLegend(pal = pal, 
            values = ~RentTaxRatio, 
            opacity = 0.9, 
            title = "Estimated Rent to Tax Ratio for 2020", 
            position = "bottomleft")


#outlines charlottesville but labels censustracts in another part of the world


#another simple way to graph with sf

ggplot(HousingDataSpatial) +
  geom_sf(aes(fill = County)) + 
  theme_void()
```



```{r}
ACS_Housing_Data |>
  filter(County == "Fluvanna")
```

